This is the first version of chapter6.