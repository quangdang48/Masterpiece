This is first version of chapter 3.